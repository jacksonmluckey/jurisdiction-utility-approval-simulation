---
title: "Polycentric City Visualization Example"
format:
    html:
        embed-resources: true

---

This notebook demonstrates how to generate and visualize polycentric city density patterns using the City class.

## Setup

```{python}
import sys
sys.path.append('..')

from city import City, CityConfig
from city import PolycentricConfig, TransportationConfig, CorridorType
```

## City Class Examples

The `City` class provides a unified interface for creating cities with all configuration in one place. Here are several examples demonstrating different city types.

### Example 1: Basic City with Polycentric Density

```{python}
print("=" * 70)
print("EXAMPLE 1: Basic City with Polycentric Density")
print("=" * 70)

# Configure city parameters
city_config = CityConfig(
    width=50,
    height=50,
    block_size_meters=100.0,
    block_area_acres=2.47,  # ~100m x 100m
    max_density_units_per_acre=50.0,
    min_density_units_per_acre=1.0,
    persons_per_unit=2.5
)

# Configure polycentric density
polycentric_config = PolycentricConfig(
    num_centers=3,
    center_distribution="uniform",
    primary_density=25.0,
    density_decay_rate=0.15
)

# Create and generate city
city = City(
    config=city_config,
    polycentric_config=polycentric_config
)
grid = city.generate()

# Show summary
city.summary()

# Access properties
print(f"\nCity Properties:")
print(f"  Total population: {city.total_population:,.0f}")
print(f"  Total units: {city.total_units:,}")
print(f"  Total area: {city.total_area_acres:,.1f} acres")
print(f"  Average density: {city.average_density:.2f} units/acre")
```

### Example 2: City with Transportation Corridors

```{python}
print("\n" + "=" * 70)
print("EXAMPLE 2: City with Transportation Corridors")
print("=" * 70)

# Configure transportation
transport_config = TransportationConfig(
    corridor_type=CorridorType.INTER_CENTER,
    corridor_width_blocks=2,
    density_multiplier=1.20,
    connect_all_centers=True
)

# Create city with transportation
city_with_transport = City(
    config=city_config,
    polycentric_config=polycentric_config,
    transport_configs=[transport_config]
)
grid_transport = city_with_transport.generate()

city_with_transport.summary()
```

### Example 3: High-Density City with Radial Corridors

```{python}
print("\n" + "=" * 70)
print("EXAMPLE 3: High-Density City with Radial Corridors")
print("=" * 70)

# High-density configuration
high_density_config = CityConfig(
    width=40,
    height=40,
    block_area_acres=2.47,
    max_density_units_per_acre=80.0,
    persons_per_unit=2.2  # Smaller household size in high-density areas
)

# More centers, higher density
high_density_polycentric = PolycentricConfig(
    num_centers=5,
    center_distribution="uniform",
    primary_density=35.0,
    density_decay_rate=0.10
)

# Radial corridors
radial_transport = TransportationConfig(
    corridor_type=CorridorType.RADIAL,
    corridor_width_blocks=2,
    density_multiplier=1.25,
    radial_corridors_count=6,
    include_ring_roads=True,
    ring_road_radius_blocks=10
)

city_high_density = City(
    config=high_density_config,
    polycentric_config=high_density_polycentric,
    transport_configs=[radial_transport]
)
city_high_density.generate()
city_high_density.summary()
```

### Example 4: City with Multiple Transportation Corridors

```{python}
print("\n" + "=" * 70)
print("EXAMPLE 4: City with Multiple Transportation Corridors")
print("=" * 70)

# Configure multiple transportation corridor types
# 1. Wide highways connecting centers
highways = TransportationConfig(
    corridor_type=CorridorType.INTER_CENTER,
    corridor_width_blocks=3,
    density_multiplier=1.10,
    connect_all_centers=True
)

# 2. Narrow transit grid
transit_grid = TransportationConfig(
    corridor_type=CorridorType.GRID,
    corridor_width_blocks=1,
    density_multiplier=1.25
)

# 3. Radial corridors from center
radial = TransportationConfig(
    corridor_type=CorridorType.RADIAL,
    corridor_width_blocks=2,
    density_multiplier=1.15,
    radial_corridors_count=6
)

# Create city with all three corridor types
city_multi = City(
    config=city_config,
    polycentric_config=polycentric_config,
    transport_configs=[highways, transit_grid, radial]
)
city_multi.generate()
city_multi.summary()

print("\n" + "=" * 70)
print("All examples completed successfully!")
print("=" * 70)
```

---

## Alternative: Using Individual Components

You can also use `PolycentricCity` directly for more granular control:

### Setup (Alternative)

```{python}
from city import PolycentricCity, PolycentricConfig
from city import visualize_grid, visualize_population, visualize_units, print_grid_summary
from city import visualize_with_corridors
```

## Generate a Polycentric City

Create a city with 3 centers distributed uniformly:

```{python}
# Configure the city
config = PolycentricConfig(
    num_centers=5,
    center_distribution="uniform",
    primary_density=18.0,
    density_decay_rate=0.1,
    center_strength_decay=0.6,
    persons_per_unit=2.5
)

# Generate the city
city = PolycentricCity(grid_rows=100, grid_cols=100, config=config)
grid = city.generate()

# Show summary
city.visualize_summary()
```

## Visualize the City

### Combined View (Population + Units)

```{python}
#| fig-width: 12
#| fig-height: 5

# Pass the city object directly instead of just the grid
visualize_grid(city, show=True)
```

### Population Distribution

```{python}
#| fig-width: 8
#| fig-height: 7

# Pass the city object directly instead of just the grid
visualize_population(city, show=True)
```

### Housing Units Distribution

```{python}
#| fig-width: 8
#| fig-height: 7

# Pass the city object directly instead of just the grid
visualize_units(city, show=True)
```

## Grid Statistics

```{python}
# Pass the city object directly instead of just the grid
print_grid_summary(city)
```

## Compare Different Configurations

### Clustered Centers

```{python}
#| fig-width: 12
#| fig-height: 5

config_clustered = PolycentricConfig(
    num_centers=3,
    center_distribution="clustered",
    primary_density=18.0
)

city_clustered = PolycentricCity(grid_rows=30, grid_cols=30, config=config_clustered)
grid_clustered = city_clustered.generate()

# Pass the city object directly
visualize_grid(city_clustered, show=True)
```

### Random Centers

```{python}
#| fig-width: 12
#| fig-height: 5

config_random = PolycentricConfig(
    num_centers=5,
    center_distribution="random",
    primary_density=18.0,
    min_center_separation_blocks=8
)

city_random = PolycentricCity(grid_rows=30, grid_cols=30, config=config_random)
grid_random = city_random.generate()

# Pass the city object directly
visualize_grid(city_random, show=True)
```

## Cities with Transportation Corridors

Transportation corridors can significantly affect density patterns by providing higher accessibility along major routes.

### Inter-Center Corridors

Connect all activity centers with transportation corridors:

```{python}
#| fig-width: 15
#| fig-height: 5

# Configure city with transportation
config_transport = PolycentricConfig(
    num_centers=4,
    center_distribution="uniform",
    primary_density=18.0,
    density_decay_rate=0.15
)

transport_config = TransportationConfig(
    corridor_type=CorridorType.INTER_CENTER,
    corridor_width_blocks=2,
    density_multiplier=1.20,  # 20% density boost along corridors
    connect_all_centers=True
)

# Generate city with corridors
city_transport = PolycentricCity(
    grid_rows=60,
    grid_cols=60,
    config=config_transport,
    transport_configs=[transport_config]
)
grid_transport = city_transport.generate()

# Show summary
city_transport.visualize_summary()

# Visualize with corridors highlighted - pass city object directly
visualize_with_corridors(city_transport, show=True)
```

### Radial Corridors (Hub-and-Spoke)

Create a hub-and-spoke pattern from the primary center:

```{python}
#| fig-width: 15
#| fig-height: 5

transport_config_radial = TransportationConfig(
    corridor_type=CorridorType.RADIAL,
    corridor_width_blocks=2,
    density_multiplier=1.15,
    radial_corridors_count=6,
    include_ring_roads=True,
    ring_road_radius_blocks=15
)

city_radial = PolycentricCity(
    grid_rows=60,
    grid_cols=60,
    config=config_transport,
    transport_configs=[transport_config_radial]
)
grid_radial = city_radial.generate()

# Pass city object directly
visualize_with_corridors(city_radial, show=True)
```

### Grid Pattern (Manhattan-style)

Orthogonal grid of major transportation routes:

```{python}
#| fig-width: 15
#| fig-height: 5

transport_config_grid = TransportationConfig(
    corridor_type=CorridorType.GRID,
    corridor_width_blocks=1,
    density_multiplier=1.10
)

city_grid = PolycentricCity(
    grid_rows=60,
    grid_cols=60,
    config=config_transport,
    transport_configs=[transport_config_grid]
)
grid_grid_pattern = city_grid.generate()

# Pass city object directly
visualize_with_corridors(city_grid, show=True)
```

## San Francisco Clone

```{python}
city_config = CityConfig(
    width=100,
    height=100,
    block_size_meters=100.0,
    block_area_acres=2.47,  # ~100m x 100m
    max_density_units_per_acre=100.0,
    min_density_units_per_acre=1.0,
    persons_per_unit=2.5
)

# Configure polycentric density
polycentric_config = PolycentricConfig(
    num_centers=8,
    center_distribution="uniform",
    primary_density=50,
    density_decay_rate=0.2
)

main_roads = TransportationConfig(
    corridor_type=CorridorType.INTER_CENTER,
    corridor_width_blocks=3,
    density_multiplier=1.3,
    connect_all_centers=True
)

# 2. Narrow transit grid
transit_grid = TransportationConfig(
    corridor_type=CorridorType.GRID,
    corridor_width_blocks=1,
    density_multiplier=1.1
)

# 3. Radial corridors from center
radial = TransportationConfig(
    corridor_type=CorridorType.RADIAL,
    corridor_width_blocks=2,
    density_multiplier=1.2,
    radial_corridors_count=6
)

# Create city with all three corridor types
city_sf_like = City(
    config=city_config,
    polycentric_config=polycentric_config,
    transport_configs=[main_roads, transit_grid, radial]
)
grid = city_sf_like.generate()

# Pass city object directly
visualize_with_corridors(city_sf_like, show=True)
```
